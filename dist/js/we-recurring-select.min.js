/*! For license information please see we-recurring-select.min.js.LICENSE.txt */
(()=>{"use strict";var e={609:e=>{e.exports=jQuery}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t;t=r(609);const n=function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.positionDialogVert=this.positionDialogVert.bind(this),this.cancel=this.cancel.bind(this),this.outerCancel=this.outerCancel.bind(this),this.save=this.save.bind(this),this.summaryUpdate=this.summaryUpdate.bind(this),this.summaryFetchSuccess=this.summaryFetchSuccess.bind(this),this.init_calendar_days=this.init_calendar_days.bind(this),this.init_calendar_weeks=this.init_calendar_weeks.bind(this),this.toggle_month_view=this.toggle_month_view.bind(this),this.freqChanged=this.freqChanged.bind(this),this.intervalChanged=this.intervalChanged.bind(this),this.daysChanged=this.daysChanged.bind(this),this.dateOfMonthChanged=this.dateOfMonthChanged.bind(this),this.weekOfMonthChanged=this.weekOfMonthChanged.bind(this),this.recurring_selector=e,this.current_rule=this.recurring_selector.recurring_select("current_rule"),this.initDialogBox(),null==this.current_rule.hash||null==this.current_rule.hash.rule_type?this.freqChanged():setTimeout(this.positionDialogVert,10)}var n,s;return n=r,(s=[{key:"initDialogBox",value:function(){var e;return t(".rs_dialog_holder").remove(),e=t("body"),t(".ui-page-active").length&&(e=t(".ui-page-active")),e.append(this.template()),this.outer_holder=t(".rs_dialog_holder"),this.inner_holder=this.outer_holder.find(".rs_dialog"),this.content=this.outer_holder.find(".rs_dialog_content"),this.positionDialogVert(!0),this.mainEventInit(),this.freqInit(),this.summaryInit(),this.outer_holder.trigger("recurring_select:dialog_opened"),this.freq_select.focus()}},{key:"positionDialogVert",value:function(e){var r,n,s,i,a=this;return i=t(window).height(),t(window).width(),(r=this.content.outerHeight())<80&&(r=80),(n=(i-r)/2-30)<10&&(n=10),s={"margin-top":n+"px","min-height":r+"px"},null!=e?(this.inner_holder.css(s),this.inner_holder.trigger("recurring_select:dialog_positioned")):(this.inner_holder.addClass("animated"),this.inner_holder.animate(s,200,(function(){return a.inner_holder.removeClass("animated"),a.content.css({width:"auto"}),a.inner_holder.trigger("recurring_select:dialog_positioned")})))}},{key:"cancel",value:function(){return this.outer_holder.remove(),this.recurring_selector.recurring_select("cancel")}},{key:"outerCancel",value:function(e){if(t(e.target).hasClass("rs_dialog_holder"))return this.cancel()}},{key:"save",value:function(){if(null!=this.current_rule.str)return this.outer_holder.remove(),this.recurring_selector.recurring_select("save",this.current_rule)}},{key:"mainEventInit",value:function(){return this.outer_holder.on("click tap",this.outerCancel),this.content.on("click tap","h1 a",this.cancel),this.save_button=this.content.find("input.rs_save").on("click tap",this.save),this.content.find("input.rs_cancel").on("click tap",this.cancel)}},{key:"freqInit",value:function(){var e;return this.freq_select=this.outer_holder.find(".rs_frequency"),null!=this.current_rule.hash&&null!=(e=this.current_rule.hash.rule_type)&&(-1!==e.search(/Weekly/)?(this.freq_select.prop("selectedIndex",1),this.initWeeklyOptions()):-1!==e.search(/Monthly/)?(this.freq_select.prop("selectedIndex",2),this.initMonthlyOptions()):-1!==e.search(/Yearly/)?(this.freq_select.prop("selectedIndex",3),this.initYearlyOptions()):this.initDailyOptions()),this.freq_select.on("change",this.freqChanged)}},{key:"initDailyOptions",value:function(){var e,t;return(e=(t=this.content.find(".daily_options")).find(".rs_daily_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged),t.show()}},{key:"initWeeklyOptions",value:function(){var e,r;return(e=(r=this.content.find(".weekly_options")).find(".rs_weekly_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged),r.find(".day_holder a").each((function(e,r){return t(r).removeClass("selected")})),null!=this.current_rule.hash.validations&&null!=this.current_rule.hash.validations.day&&t(this.current_rule.hash.validations.day).each((function(e,t){return r.find(".day_holder a[data-value='"+t+"']").addClass("selected")})),r.off("click",".day_holder a").on("click",".day_holder a",this.daysChanged),r.show()}},{key:"initMonthlyOptions",value:function(){var e,t,r,n,s,i;return(s=(i=this.content.find(".monthly_options")).find(".rs_monthly_interval")).val(this.current_rule.hash.interval),s.on("change keyup",this.intervalChanged),(e=this.current_rule.hash).validations||(e.validations={}),(t=this.current_rule.hash.validations).day_of_month||(t.day_of_month=[]),(r=this.current_rule.hash.validations).day_of_week||(r.day_of_week={}),this.init_calendar_days(i),this.init_calendar_weeks(i),n=Object.keys(this.current_rule.hash.validations.day_of_week).length>0,i.find(".monthly_rule_type_week").prop("checked",n),i.find(".monthly_rule_type_day").prop("checked",!n),this.toggle_month_view(),i.find("input[name=monthly_rule_type]").on("change",this.toggle_month_view),i.show()}},{key:"initYearlyOptions",value:function(){var e,t;return(e=(t=this.content.find(".yearly_options")).find(".rs_yearly_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged),t.show()}},{key:"summaryInit",value:function(){return this.summary=this.outer_holder.find(".rs_summary"),this.summaryUpdate()}},{key:"summaryUpdate",value:function(e){var r;return this.summary.width(this.content.width()),null!=this.current_rule.hash&&null!=this.current_rule.str?(this.summary.removeClass("fetching"),this.save_button.removeClass("disabled"),(r=this.current_rule.str.replace("*","")).length<20&&(r="".concat(t.fn.recurring_select.texts.summary,": ")+r),this.summary.find("span").html(r)):(this.summary.addClass("fetching"),this.save_button.addClass("disabled"),this.summary.find("span").html(""),this.summaryFetch())}},{key:"summaryFetch",value:function(){if(null!=this.current_rule.hash&&null!=this.current_rule.hash.rule_type)return this.current_rule.hash.week_start=t.fn.recurring_select.texts.first_day_of_week,t.ajax({url:"/recurring_select/translate/en",type:"POST",data:this.current_rule.hash,success:this.summaryFetchSuccess})}},{key:"summaryFetchSuccess",value:function(e){return this.current_rule.str=e,this.summaryUpdate(),this.content.css({width:"auto"})}},{key:"init_calendar_days",value:function(e){var r,n,s,i,a;for((i=e.find(".rs_calendar_day")).html(""),a=s=1;s<=31;a=++s)i.append(r=t(document.createElement("a")).text(a)),-1!==t.inArray(a,this.current_rule.hash.validations.day_of_month)&&r.addClass("selected");return i.append(n=t(document.createElement("a")).text(t.fn.recurring_select.texts.last_day)),n.addClass("end_of_month"),-1!==t.inArray(-1,this.current_rule.hash.validations.day_of_month)&&n.addClass("selected"),i.find("a").on("click tap",this.dateOfMonthChanged)}},{key:"init_calendar_weeks",value:function(e){var r,n,s,i,a,l,c,h,u,o,_,d,y,p;for((h=e.find(".rs_calendar_week")).html(""),y=t.fn.recurring_select.texts.order,p=t.fn.recurring_select.options.monthly.show_week,r=t.fn.recurring_select.texts.days_first_letter,a=i=0,c=(o=[1,2,3,4,5,6]).length;i<c;a=++i)if(u=o[a],p[a])for(h.append("<span>".concat(y[u-1],"</span>")),s=l=_=t.fn.recurring_select.texts.first_day_of_week,d=7+t.fn.recurring_select.texts.first_day_of_week;_<=d?l<d:l>d;s=_<=d?++l:--l)(n=t("<a>",{text:r[s%=7]})).attr("day",s),n.attr("instance",u),h.append(n);return t.each(this.current_rule.hash.validations.day_of_week,(function(r,n){return t.each(n,(function(t,n){return e.find("a[day='".concat(r,"'][instance='").concat(n,"']")).addClass("selected")}))})),h.find("a").on("click tap",this.weekOfMonthChanged)}},{key:"toggle_month_view",value:function(){var e;return e=this.content.find(".monthly_rule_type_week").prop("checked"),this.content.find(".rs_calendar_week").toggle(e),this.content.find(".rs_calendar_day").toggle(!e)}},{key:"freqChanged",value:function(){var e;switch(t.isPlainObject(this.current_rule.hash)||(this.current_rule.hash=null),(e=this.current_rule).hash||(e.hash={}),this.current_rule.hash.interval=1,this.current_rule.hash.until=null,this.current_rule.hash.count=null,this.current_rule.hash.validations=null,this.content.find(".freq_option_section").hide(),this.content.find("input[type=radio], input[type=checkbox]").prop("checked",!1),this.freq_select.val()){case"Weekly":this.current_rule.hash.rule_type="IceCube::WeeklyRule",this.current_rule.str=t.fn.recurring_select.texts.weekly,this.initWeeklyOptions();break;case"Monthly":this.current_rule.hash.rule_type="IceCube::MonthlyRule",this.current_rule.str=t.fn.recurring_select.texts.monthly,this.initMonthlyOptions();break;case"Yearly":this.current_rule.hash.rule_type="IceCube::YearlyRule",this.current_rule.str=t.fn.recurring_select.texts.yearly,this.initYearlyOptions();break;default:this.current_rule.hash.rule_type="IceCube::DailyRule",this.current_rule.str=t.fn.recurring_select.texts.daily,this.initDailyOptions()}return this.summaryUpdate(),this.positionDialogVert()}},{key:"intervalChanged",value:function(e){var r;return this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.interval=parseInt(t(e.currentTarget).val()),(this.current_rule.hash.interval<1||isNaN(this.current_rule.hash.interval))&&(this.current_rule.hash.interval=1),this.summaryUpdate()}},{key:"daysChanged",value:function(e){var r,n;return t(e.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},n=this.content.find(".day_holder a.selected").map((function(){return parseInt(t(this).data("value"))})),this.current_rule.hash.validations.day=n.get(),this.summaryUpdate(),!1}},{key:"dateOfMonthChanged",value:function(e){var r,n;return t(e.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},n=this.content.find(".monthly_options .rs_calendar_day a.selected").map((function(){return t(this).text()===t.fn.recurring_select.texts.last_day?-1:parseInt(t(this).text())})),this.current_rule.hash.validations.day_of_week={},this.current_rule.hash.validations.day_of_month=n.get(),this.summaryUpdate(),!1}},{key:"weekOfMonthChanged",value:function(e){var r,n=this;return t(e.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},this.current_rule.hash.validations.day_of_month=[],this.current_rule.hash.validations.day_of_week={},this.content.find(".monthly_options .rs_calendar_week a.selected").each((function(e,r){var s,i,a;return i=parseInt(t(r).attr("day")),a=parseInt(t(r).attr("instance")),(s=n.current_rule.hash.validations.day_of_week)[i]||(s[i]=[]),n.current_rule.hash.validations.day_of_week[i].push(a)})),this.summaryUpdate(),!1}},{key:"template",value:function(){var e,r,n,s,i;for(i="<div class='rs_dialog_holder'> <div class='rs_dialog'> <div class='rs_dialog_content'> <h1>".concat(t.fn.recurring_select.texts.repeat," <a href='#' title='").concat(t.fn.recurring_select.texts.cancel,"' Alt='").concat(t.fn.recurring_select.texts.cancel,"'></a> </h1> <p class='frequency-select-wrapper'> <label for='rs_frequency'>").concat(t.fn.recurring_select.texts.frequency,":</label> <select data-wrapper-class='ui-recurring-select' id='rs_frequency' class='rs_frequency' name='rs_frequency'> <option value='Daily'>").concat(t.fn.recurring_select.texts.daily,"</option> <option value='Weekly'>").concat(t.fn.recurring_select.texts.weekly,"</option> <option value='Monthly'>").concat(t.fn.recurring_select.texts.monthly,"</option> <option value='Yearly'>").concat(t.fn.recurring_select.texts.yearly,"</option> </select> </p> <div class='daily_options freq_option_section'> <p> ").concat(t.fn.recurring_select.texts.every," <input type='text' data-wrapper-class='ui-recurring-select' name='rs_daily_interval' class='rs_daily_interval rs_interval' value='1' size='2' /> ").concat(t.fn.recurring_select.texts.days," </p> </div> <div class='weekly_options freq_option_section'> <p> ").concat(t.fn.recurring_select.texts.every," <input type='text' data-wrapper-class='ui-recurring-select' name='rs_weekly_interval' class='rs_weekly_interval rs_interval' value='1' size='2' /> ").concat(t.fn.recurring_select.texts.weeks_on,": </p> <div class='day_holder'>"),e=r=n=t.fn.recurring_select.texts.first_day_of_week,s=7+t.fn.recurring_select.texts.first_day_of_week;n<=s?r<s:r>s;e=n<=s?++r:--r)i+="<a href='#' data-value='".concat(e%=7,"'>").concat(t.fn.recurring_select.texts.days_first_letter[e],"</a>");return i+"</div> <span style='clear:both; visibility:hidden; height:1px;'>.</span> </div> <div class='monthly_options freq_option_section'> <p> ".concat(t.fn.recurring_select.texts.every," <input type='text' data-wrapper-class='ui-recurring-select' name='rs_monthly_interval' class='rs_monthly_interval rs_interval' value='1' size='2' /> ").concat(t.fn.recurring_select.texts.months,": </p> <p class='monthly_rule_type'> <span><label for='monthly_rule_type_day'>").concat(t.fn.recurring_select.texts.day_of_month,"</label><input type='radio' class='monthly_rule_type_day' name='monthly_rule_type' id='monthly_rule_type_day' value='true' /></span> <span><label for='monthly_rule_type_week'>").concat(t.fn.recurring_select.texts.day_of_week,"</label><input type='radio' class='monthly_rule_type_week' name='monthly_rule_type' id='monthly_rule_type_week' value='true' /></span> </p> <p class='rs_calendar_day'></p> <p class='rs_calendar_week'></p> </div> <div class='yearly_options freq_option_section'> <p> ").concat(t.fn.recurring_select.texts.every," <input type='text' data-wrapper-class='ui-recurring-select' name='rs_yearly_interval' class='rs_yearly_interval rs_interval' value='1' size='2' /> ").concat(t.fn.recurring_select.texts.years," </p> </div> <p class='rs_summary'> <span></span> </p> <div class='controls'> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_save' value='").concat(t.fn.recurring_select.texts.ok,"' /> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_cancel' value='").concat(t.fn.recurring_select.texts.cancel,"' /> </div> </div> </div> </div>")}}])&&e(n.prototype,s),r}();var s;!function(e){s={set_initial_values:function(){return this.data("initial-value-hash",this.val()),this.data("initial-value-str",e(this.find("option").get()[this.prop("selectedIndex")]).text())},changed:function(){return"custom"===this.val()?s.open_custom.apply(this):s.set_initial_values.apply(this)},open_custom:function(){return this.data("recurring-select-active",!0),new n(this),this.blur()},save:function(t){var r;return this.find("option[data-custom]").remove(),r=JSON.stringify(t.hash),-1===e.inArray(r,this.find("option").map((function(){return e(this).val()})))&&s.insert_option.apply(this,[t.str,r]),this.val(r),s.set_initial_values.apply(this),this.trigger("recurring_select:save")},current_rule:function(){return{str:this.data("initial-value-str"),hash:e.parseJSON(this.data("initial-value-hash"))}},cancel:function(){return this.val(this.data("initial-value-hash")),this.data("recurring-select-active",!1),this.trigger("recurring_select:cancel")},insert_option:function(t,r){var n,s;return 0===(s=this.find("option:disabled")).length&&(s=this.find("option")),s=s.last(),(n=e(document.createElement("option"))).attr("data-custom",!0),"*"!==t.substr(t.length-1)&&(t+="*"),n.text(t),n.val(r),n.insertBefore(s)},methods:function(){return s}},e.fn.recurring_select=function(t){return t in s?s[t].apply(this,Array.prototype.slice.call(arguments,1)):e.error("Method ".concat(t," does not exist on jQuery.recurring_select"))},e.fn.recurring_select.options={monthly:{show_week:[!0,!0,!0,!0,!1,!1]}},e.fn.recurring_select.texts={locale_iso_code:"en",repeat:"Repeat",last_day:"Last Day",frequency:"Frequency",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",every:"Every",days:"day(s)",weeks_on:"week(s) on",months:"month(s)",years:"year(s)",day_of_month:"Day of month",day_of_week:"Day of week",cancel:"Cancel",ok:"OK",summary:"Summary",first_day_of_week:0,days_first_letter:["S","M","T","W","T","F","S"],order:["1st","2nd","3rd","4th","5th","Last"],show_week:[!0,!0,!0,!0,!1,!1]}}(jQuery)})()})();