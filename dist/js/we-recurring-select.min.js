/*! For license information please see we-recurring-select.min.js.LICENSE.txt */
(()=>{"use strict";var e={609:e=>{e.exports=jQuery}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}(()=>{var e;e=r(609);const t=class{constructor(e){this.positionDialogVert=this.positionDialogVert.bind(this),this.cancel=this.cancel.bind(this),this.outerCancel=this.outerCancel.bind(this),this.save=this.save.bind(this),this.summaryUpdate=this.summaryUpdate.bind(this),this.summaryFetchSuccess=this.summaryFetchSuccess.bind(this),this.init_calendar_days=this.init_calendar_days.bind(this),this.init_calendar_weeks=this.init_calendar_weeks.bind(this),this.toggle_month_view=this.toggle_month_view.bind(this),this.freqChanged=this.freqChanged.bind(this),this.intervalChanged=this.intervalChanged.bind(this),this.daysChanged=this.daysChanged.bind(this),this.dateOfMonthChanged=this.dateOfMonthChanged.bind(this),this.weekOfMonthChanged=this.weekOfMonthChanged.bind(this),this.recurring_selector=e,this.current_rule=this.recurring_selector.recurring_select("current_rule"),this.initDialogBox(),null==this.current_rule.hash||null==this.current_rule.hash.rule_type?this.freqChanged():setTimeout(this.positionDialogVert,10)}initDialogBox(){var t;return e(".rs_dialog_holder").remove(),t=e("body"),e(".ui-page-active").length&&(t=e(".ui-page-active")),t.append(this.template()),this.outer_holder=e(".rs_dialog_holder"),this.inner_holder=this.outer_holder.find(".rs_dialog"),this.content=this.outer_holder.find(".rs_dialog_content"),this.positionDialogVert(!0),this.mainEventInit(),this.freqInit(),this.summaryInit(),this.outer_holder.trigger("recurring_select:dialog_opened"),this.freq_select.focus()}positionDialogVert(t){var r,s,n,i;return i=e(window).height(),e(window).width(),(r=this.content.outerHeight())<80&&(r=80),(s=(i-r)/2-30)<10&&(s=10),n={"margin-top":s+"px","min-height":r+"px"},null!=t?(this.inner_holder.css(n),this.inner_holder.trigger("recurring_select:dialog_positioned")):(this.inner_holder.addClass("animated"),this.inner_holder.animate(n,200,(()=>(this.inner_holder.removeClass("animated"),this.content.css({width:"auto"}),this.inner_holder.trigger("recurring_select:dialog_positioned")))))}cancel(){return this.outer_holder.remove(),this.recurring_selector.recurring_select("cancel")}outerCancel(t){if(e(t.target).hasClass("rs_dialog_holder"))return this.cancel()}save(){if(null!=this.current_rule.str)return this.outer_holder.remove(),this.recurring_selector.recurring_select("save",this.current_rule)}mainEventInit(){return this.outer_holder.on("click tap",this.outerCancel),this.content.on("click tap","h1 a",this.cancel),this.save_button=this.content.find("input.rs_save").on("click tap",this.save),this.content.find("input.rs_cancel").on("click tap",this.cancel)}freqInit(){var e;return this.freq_select=this.outer_holder.find(".rs_frequency"),null!=this.current_rule.hash&&null!=(e=this.current_rule.hash.rule_type)&&(-1!==e.search(/Weekly/)?(this.freq_select.prop("selectedIndex",1),this.initWeeklyOptions()):-1!==e.search(/Monthly/)?(this.freq_select.prop("selectedIndex",2),this.initMonthlyOptions()):-1!==e.search(/Yearly/)?(this.freq_select.prop("selectedIndex",3),this.initYearlyOptions()):this.initDailyOptions()),this.freq_select.on("change",this.freqChanged)}initDailyOptions(){var e,t;return(e=(t=this.content.find(".daily_options")).find(".rs_daily_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged),t.show()}initWeeklyOptions(){var t,r;return(t=(r=this.content.find(".weekly_options")).find(".rs_weekly_interval")).val(this.current_rule.hash.interval),t.on("change keyup",this.intervalChanged),r.find(".day_holder a").each((function(t,r){return e(r).removeClass("selected")})),null!=this.current_rule.hash.validations&&null!=this.current_rule.hash.validations.day&&e(this.current_rule.hash.validations.day).each((function(e,t){return r.find(".day_holder a[data-value='"+t+"']").addClass("selected")})),r.off("click",".day_holder a").on("click",".day_holder a",this.daysChanged),r.show()}initMonthlyOptions(){var e,t,r,s,n,i;return(n=(i=this.content.find(".monthly_options")).find(".rs_monthly_interval")).val(this.current_rule.hash.interval),n.on("change keyup",this.intervalChanged),(e=this.current_rule.hash).validations||(e.validations={}),(t=this.current_rule.hash.validations).day_of_month||(t.day_of_month=[]),(r=this.current_rule.hash.validations).day_of_week||(r.day_of_week={}),this.init_calendar_days(i),this.init_calendar_weeks(i),s=Object.keys(this.current_rule.hash.validations.day_of_week).length>0,i.find(".monthly_rule_type_week").prop("checked",s),i.find(".monthly_rule_type_day").prop("checked",!s),this.toggle_month_view(),i.find("input[name=monthly_rule_type]").on("change",this.toggle_month_view),i.show()}initYearlyOptions(){var e,t;return(e=(t=this.content.find(".yearly_options")).find(".rs_yearly_interval")).val(this.current_rule.hash.interval),e.on("change keyup",this.intervalChanged),t.show()}summaryInit(){return this.summary=this.outer_holder.find(".rs_summary"),this.summaryUpdate()}summaryUpdate(t){var r;return this.summary.width(this.content.width()),null!=this.current_rule.hash&&null!=this.current_rule.str?(this.summary.removeClass("fetching"),this.save_button.removeClass("disabled"),(r=this.current_rule.str.replace("*","")).length<20&&(r=`${e.fn.recurring_select.texts.summary}: `+r),this.summary.find("span").html(r)):(this.summary.addClass("fetching"),this.save_button.addClass("disabled"),this.summary.find("span").html(""),this.summaryFetch())}summaryFetch(){if(null!=this.current_rule.hash&&null!=this.current_rule.hash.rule_type)return this.current_rule.hash.week_start=e.fn.recurring_select.texts.first_day_of_week,e.ajax({url:"/recurring_select/translate/en",type:"POST",data:this.current_rule.hash,success:this.summaryFetchSuccess})}summaryFetchSuccess(e){return this.current_rule.str=e,this.summaryUpdate(),this.content.css({width:"auto"})}init_calendar_days(t){var r,s,n,i,a;for((i=t.find(".rs_calendar_day")).html(""),a=n=1;n<=31;a=++n)i.append(r=e(document.createElement("a")).text(a)),-1!==e.inArray(a,this.current_rule.hash.validations.day_of_month)&&r.addClass("selected");return i.append(s=e(document.createElement("a")).text(e.fn.recurring_select.texts.last_day)),s.addClass("end_of_month"),-1!==e.inArray(-1,this.current_rule.hash.validations.day_of_month)&&s.addClass("selected"),i.find("a").on("click tap",this.dateOfMonthChanged)}init_calendar_weeks(t){var r,s,n,i,a,l,h,c,u,o,_,d,y,p;for((c=t.find(".rs_calendar_week")).html(""),y=e.fn.recurring_select.texts.order,p=e.fn.recurring_select.options.monthly.show_week,r=e.fn.recurring_select.texts.days_first_letter,a=i=0,h=(o=[1,2,3,4,5,6]).length;i<h;a=++i)if(u=o[a],p[a])for(c.append(`<span>${y[u-1]}</span>`),n=l=_=e.fn.recurring_select.texts.first_day_of_week,d=7+e.fn.recurring_select.texts.first_day_of_week;_<=d?l<d:l>d;n=_<=d?++l:--l)(s=e("<a>",{text:r[n%=7]})).attr("day",n),s.attr("instance",u),c.append(s);return e.each(this.current_rule.hash.validations.day_of_week,(function(r,s){return e.each(s,(function(e,s){return t.find(`a[day='${r}'][instance='${s}']`).addClass("selected")}))})),c.find("a").on("click tap",this.weekOfMonthChanged)}toggle_month_view(){var e;return e=this.content.find(".monthly_rule_type_week").prop("checked"),this.content.find(".rs_calendar_week").toggle(e),this.content.find(".rs_calendar_day").toggle(!e)}freqChanged(){var t;switch(e.isPlainObject(this.current_rule.hash)||(this.current_rule.hash=null),(t=this.current_rule).hash||(t.hash={}),this.current_rule.hash.interval=1,this.current_rule.hash.until=null,this.current_rule.hash.count=null,this.current_rule.hash.validations=null,this.content.find(".freq_option_section").hide(),this.content.find("input[type=radio], input[type=checkbox]").prop("checked",!1),this.freq_select.val()){case"Weekly":this.current_rule.hash.rule_type="IceCube::WeeklyRule",this.current_rule.str=e.fn.recurring_select.texts.weekly,this.initWeeklyOptions();break;case"Monthly":this.current_rule.hash.rule_type="IceCube::MonthlyRule",this.current_rule.str=e.fn.recurring_select.texts.monthly,this.initMonthlyOptions();break;case"Yearly":this.current_rule.hash.rule_type="IceCube::YearlyRule",this.current_rule.str=e.fn.recurring_select.texts.yearly,this.initYearlyOptions();break;default:this.current_rule.hash.rule_type="IceCube::DailyRule",this.current_rule.str=e.fn.recurring_select.texts.daily,this.initDailyOptions()}return this.summaryUpdate(),this.positionDialogVert()}intervalChanged(t){var r;return this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.interval=parseInt(e(t.currentTarget).val()),(this.current_rule.hash.interval<1||isNaN(this.current_rule.hash.interval))&&(this.current_rule.hash.interval=1),this.summaryUpdate()}daysChanged(t){var r,s;return e(t.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},s=this.content.find(".day_holder a.selected").map((function(){return parseInt(e(this).data("value"))})),this.current_rule.hash.validations.day=s.get(),this.summaryUpdate(),!1}dateOfMonthChanged(t){var r,s;return e(t.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},s=this.content.find(".monthly_options .rs_calendar_day a.selected").map((function(){return e(this).text()===e.fn.recurring_select.texts.last_day?-1:parseInt(e(this).text())})),this.current_rule.hash.validations.day_of_week={},this.current_rule.hash.validations.day_of_month=s.get(),this.summaryUpdate(),!1}weekOfMonthChanged(t){var r;return e(t.currentTarget).toggleClass("selected"),this.current_rule.str=null,(r=this.current_rule).hash||(r.hash={}),this.current_rule.hash.validations={},this.current_rule.hash.validations.day_of_month=[],this.current_rule.hash.validations.day_of_week={},this.content.find(".monthly_options .rs_calendar_week a.selected").each(((t,r)=>{var s,n,i;return n=parseInt(e(r).attr("day")),i=parseInt(e(r).attr("instance")),(s=this.current_rule.hash.validations.day_of_week)[n]||(s[n]=[]),this.current_rule.hash.validations.day_of_week[n].push(i)})),this.summaryUpdate(),!1}template(){var t,r,s,n,i;for(i=`<div class='rs_dialog_holder'> <div class='rs_dialog'> <div class='rs_dialog_content'> <h1>${e.fn.recurring_select.texts.repeat} <a href='#' title='${e.fn.recurring_select.texts.cancel}' Alt='${e.fn.recurring_select.texts.cancel}'></a> </h1> <p class='frequency-select-wrapper'> <label for='rs_frequency'>${e.fn.recurring_select.texts.frequency}:</label> <select data-wrapper-class='ui-recurring-select' id='rs_frequency' class='rs_frequency' name='rs_frequency'> <option value='Daily'>${e.fn.recurring_select.texts.daily}</option> <option value='Weekly'>${e.fn.recurring_select.texts.weekly}</option> <option value='Monthly'>${e.fn.recurring_select.texts.monthly}</option> <option value='Yearly'>${e.fn.recurring_select.texts.yearly}</option> </select> </p> <div class='daily_options freq_option_section'> <p> ${e.fn.recurring_select.texts.every} <input type='text' data-wrapper-class='ui-recurring-select' name='rs_daily_interval' class='rs_daily_interval rs_interval' value='1' size='2' /> ${e.fn.recurring_select.texts.days} </p> </div> <div class='weekly_options freq_option_section'> <p> ${e.fn.recurring_select.texts.every} <input type='text' data-wrapper-class='ui-recurring-select' name='rs_weekly_interval' class='rs_weekly_interval rs_interval' value='1' size='2' /> ${e.fn.recurring_select.texts.weeks_on}: </p> <div class='day_holder'>`,t=r=s=e.fn.recurring_select.texts.first_day_of_week,n=7+e.fn.recurring_select.texts.first_day_of_week;s<=n?r<n:r>n;t=s<=n?++r:--r)i+=`<a href='#' data-value='${t%=7}'>${e.fn.recurring_select.texts.days_first_letter[t]}</a>`;return i+`</div> <span style='clear:both; visibility:hidden; height:1px;'>.</span> </div> <div class='monthly_options freq_option_section'> <p> ${e.fn.recurring_select.texts.every} <input type='text' data-wrapper-class='ui-recurring-select' name='rs_monthly_interval' class='rs_monthly_interval rs_interval' value='1' size='2' /> ${e.fn.recurring_select.texts.months}: </p> <p class='monthly_rule_type'> <span><label for='monthly_rule_type_day'>${e.fn.recurring_select.texts.day_of_month}</label><input type='radio' class='monthly_rule_type_day' name='monthly_rule_type' id='monthly_rule_type_day' value='true' /></span> <span><label for='monthly_rule_type_week'>${e.fn.recurring_select.texts.day_of_week}</label><input type='radio' class='monthly_rule_type_week' name='monthly_rule_type' id='monthly_rule_type_week' value='true' /></span> </p> <p class='rs_calendar_day'></p> <p class='rs_calendar_week'></p> </div> <div class='yearly_options freq_option_section'> <p> ${e.fn.recurring_select.texts.every} <input type='text' data-wrapper-class='ui-recurring-select' name='rs_yearly_interval' class='rs_yearly_interval rs_interval' value='1' size='2' /> ${e.fn.recurring_select.texts.years} </p> </div> <p class='rs_summary'> <span></span> </p> <div class='controls'> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_save' value='${e.fn.recurring_select.texts.ok}' /> <input type='button' data-wrapper-class='ui-recurring-select' class='rs_cancel' value='${e.fn.recurring_select.texts.cancel}' /> </div> </div> </div> </div>`}};var s;!function(e){s={set_initial_values:function(){return this.data("initial-value-hash",this.val()),this.data("initial-value-str",e(this.find("option").get()[this.prop("selectedIndex")]).text())},changed:function(){return"custom"===this.val()?s.open_custom.apply(this):s.set_initial_values.apply(this)},open_custom:function(){return this.data("recurring-select-active",!0),new t(this),this.blur()},save:function(t){var r;return this.find("option[data-custom]").remove(),r=JSON.stringify(t.hash),-1===e.inArray(r,this.find("option").map((function(){return e(this).val()})))&&s.insert_option.apply(this,[t.str,r]),this.val(r),s.set_initial_values.apply(this),this.trigger("recurring_select:save")},current_rule:function(){return{str:this.data("initial-value-str"),hash:e.parseJSON(this.data("initial-value-hash"))}},cancel:function(){return this.val(this.data("initial-value-hash")),this.data("recurring-select-active",!1),this.trigger("recurring_select:cancel")},insert_option:function(t,r){var s,n;return 0===(n=this.find("option:disabled")).length&&(n=this.find("option")),n=n.last(),(s=e(document.createElement("option"))).attr("data-custom",!0),"*"!==t.substr(t.length-1)&&(t+="*"),s.text(t),s.val(r),s.insertBefore(n)},methods:function(){return s}},e.fn.recurring_select=function(t){return t in s?s[t].apply(this,Array.prototype.slice.call(arguments,1)):e.error(`Method ${t} does not exist on jQuery.recurring_select`)},e.fn.recurring_select.options={monthly:{show_week:[!0,!0,!0,!0,!1,!1]}},e.fn.recurring_select.texts={locale_iso_code:"en",repeat:"Repeat",last_day:"Last Day",frequency:"Frequency",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly",every:"Every",days:"day(s)",weeks_on:"week(s) on",months:"month(s)",years:"year(s)",day_of_month:"Day of month",day_of_week:"Day of week",cancel:"Cancel",ok:"OK",summary:"Summary",first_day_of_week:0,days_first_letter:["S","M","T","W","T","F","S"],order:["1st","2nd","3rd","4th","5th","Last"],show_week:[!0,!0,!0,!0,!1,!1]}}(jQuery)})()})();